---
layout: post
title: Unity中实现真实流畅的运动（一）
comments: true
date: 2018-10-26 07:50:48.000000000 +09:00
author: William Xie
tags: Unity
---

# 概述
>最近在Switch上肝了差不多90小时的《黑暗之魂》（移动传火就是棒），除去游戏本身的各种优点，作为一个游戏开发者，《黑暗之魂》里确实有很多让我佩服的地方。虽然作为一款2012年的游戏，《黑暗之魂》的画质落后于同一时期的其他游戏（比如GTA5，比如美末，比如消逝的光芒等等），但是它所拥有的很多细节，以及其巧妙的实现方法仍然让我赞叹不已。举个例子，在天寒地冻的绘画世界，不死人竟然可以在雪地上留下自己的足迹。我一开始对如何在性能羸弱（现在看来）的PS3以及Switch上实现这个效果是完全摸不着头脑的。新《古墓丽影》系列里劳拉和雪地的交互是基于动态改网格数据（*Mesh*）+曲面细分（*Tessallation*）。不过我可不觉得PS3的渲染管线里有曲面细分这一项（机能也不大支持）。但随着我某次意外地将镜头往下拉，才发现**From Software**用了一种非常简单的方法高效地实现了脚印。说白了就是动态在玩家的脚与雪地的接触点平行的放置一个脚印的透明面片。而且（据我猜测）为了防止**z-fighting**，这个面片不是紧贴地面的，而是离地面有个10公分的距离（拉下镜头可以看到一小块与地面的悬空距离）。所以当不死人踩过台阶的时候，你也许会看到半个脚印落在台阶上，半个脚印悬空的bug。不过在大多数的情况下，游戏里的镜头一直是从上往下看的，所以看起来脚印就是完美地贴合在了地上。这个小细节的处理着实惊艳，达到了机能和效果的平衡。

# 《黑暗之魂》里的人物动作
不过说了这么多废话，我还是没谈到标题里的“真实流畅的运动”。其实这还是《黑暗之魂》给我带来的启发。《黑暗之魂》一代里人物的动作比起精神前作《恶魔之魂》和《黑暗之魂》三代都缓慢了许多。玩家操作起来总是不够灵活，前后摇十分漫长。这也是为什么《黑暗之魂》只能说是一个**ARPG**而不是**ACT**游戏的原因。但今天我想讨论的是《黑暗之魂》里虽然缓慢，但却有力的人物动作。

《黑暗之魂》里的人物动作虽然不像《鬼泣》《猎天使魔女》这些**ACT**游戏迅速，但是每套动画都显得十分有力，所以更有真实感和打击感。要我说，其实是偏向《怪物猎人》的操作手感。人物挥动武器时身躯跟随武器的前进后退，左右晃动，都生动地刻画出了武器的重量感和力量感，确实十分出色。人物的跑动效果也是一步一个脚印，稳稳地在地上移动，几乎没有滑步的效果。与之相比，一些**TPS**游戏里人物一旦拔出了枪开始瞄准，人物的移动就变成脚底抹油般的平移了（没错，我说的就是你神海）。所以说真实流畅的动作的条件之一是什么？就是**消除滑步**（敲黑板）。

# 滑步的成因
我之前曾在知乎上看到一个回答提到了消除滑步的方法：![EC30FDC7-2E96-44B7-B9CB-EF293F3D7161.png](https://i.loli.net/2019/02/17/5c69706476991.png)
由此可见，角色动画滑步形成的本质是角色移动速度与角色动画给人带来的观感的不匹配。比如角色在以一个极快的速度移动，但是播放的动画却是慢走，有点类似于“缩地成寸”的效果。

一般来说，移动动画越复杂，玩家就越容易发现角色移动速度和移动动画之间的不一致。对于**我的世界**这一类的游戏，玩家的移动仅仅是非常简单的腿直挺挺地前后摆动，所以虽然仍能感受到滑步，但没有严重的感官冲突。另一个例子是**王者荣耀**这一类俯视视角的游戏。对于**王者荣耀**来说，不同角色的移动速度会影响到游戏的平衡性，所以策划会频繁地改动着角色移动速度的数值。如果每次改动移动速度的时候都让美术重新调动画，能绝对是很大的工作量，所以**王者荣耀**并没有非常严格的根据动画配置速度。但由于玩家是从上往下俯视，角色移动时的腿部细节并不是非常清晰，所以感官上的差异也就被降低了，不再严重影响游戏体验。

# 消除滑步
## 尝试一
为了消除滑步，我首先尝试根据知乎上看到的回答，不过是反着来的。我没有去调整移动的动画，而是去调整配置的速度。我希望能找到一个最合适于动画的速度，这样，当改变速度的时候，我把动画的播放速度也同步改变，以统一角色的速度和动画。然而奇怪的是，无论我怎么调节角色的位移速度，总是在某一个节点上和角色的动画会产生滑步的效果，而这个节点往往是在角色的一只脚落地的前后。难道说上述的解决方案有什么问题吗？

答案是这个方法确实有问题，因为